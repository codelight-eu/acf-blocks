# ACF Blocks
ACF Blocks is a lightweight library that provides a clean, object-oriented API to create and re-use ACF field groups and flexible layouts. Make WordPress development great again!

## Overview
ACF Blocks introduces the concept of *blocks*, which are essentially Controllers for field groups and flexible layouts. ACF Blocks greatly speeds up creating and rendering field groups for simple sites and provides a simple, clean class-based approach for more complex projects.
Fields are created using the excellent [ACF Builder](https://github.com/StoutLogic/acf-builder) library. 

## Example 1: quickly creating a simple field block and rendering it
First, create a block, define the field group and data processing callback function like so:
```php
<?php
// blocks.php

use Codelight\ACFBlocks\Blocks;
use Codelight\ACFBlocks\BlockType;

add_action('init', function() {

    // Create a new block
    $imageBlock = new BlockType('example_image');
    
    /**
     * Define ACF fields - see https://github.com/StoutLogic/acf-builder
     * Add an image field and a wysiwyg field.
     * Also add the field group to template-image.php page template
     */
    $imageBlock->getFieldsBuilder()
        ->addImage('awesome_image', ['return_format' => 'id'])
        ->addWysiwyg('boring_text')
        ->setLocation('page_template', '==', 'template-image.php');
    
    /**
     * Add a function for processing raw ACF data before it's sent to the template.
     * This allows you to do additional processing depending on the data and keep your templates clean.
     */
    $imageBlock->addCallback(function($data) {
    
        // Return the full image html with srcset attribute generated by wordpress
        $data['image'] = wp_get_attachment_image($data['awesome_image'], 'large');
        
        // Split the wysiwyg contents into an excerpt and the full text
        $data['excerpt'] = wp_trim_words($data['boring_text'], 25);
        $data['text'] = $data['boring_text'];
        
        return $data;
    });
    
    // Set the template for this block
    $imageBlock->setTemplate('templates/blocks/image.php');
    
    // Register the block with the main block manager class
    $blocks = Blocks::getInstance();
    $blocks->registerBlock($imageBlock);
}
```
Next, create the page template. In the Loop, fetch and echo the newly created block.
```php
<?php
// template-image.php
<?php while (have_posts()) : the_post(); ?>
    <?php foreach (blocks()->get() as $block): ?>
        <?= $block; ?>
    <?php endforeach; ?>
<?php endwhile; ?>
```
Finally, create a simple template for the block.
```php
<?php
// templates/blocks/image.php
<section class="section-image">
    <?= $image; ?>
    <div class="description">
        <div class="description-excerpt">
            <?= $excerpt; ?>
        </div>
        <div class="description-full">
            <?= $text; ?>
        </div>
    </div>
</section>
```
That's it.

## Example 2: encapsulate the block in a class


## Installation
### Development
In your theme's composer.json file, add the following:
```
"repositories": [
    {
      "url": "git@github.com:codelight-eu/acf-blocks.git",
      "type": "git"
    }
],
"require": {
    "codelight/acf-blocks": "dev-master"
}
```
### Production
```
composer require codelight/acf-blocks
```

## FAQ
**Will using this library have an impact on performance?**
No, it's just a really thin layer of abstraction. It doesn't do much, it just allows you to write better code.

**I'm using [soberwp/controller](https://github.com/soberwp/controller) which already provides me with a Controller. Why should I use this library?**
The concept behind soberwp/controller is great, but it has a few major drawbacks. It doesn't have any use in the context of flexible layouts. At the time of writing (Oct 7, 2017), it also has some architectural quirks such as the App controller being constructed twice. Also, inheritance doesn't really work properly so if you want to use the same field groups in multiple layouts, you'll end up stuffing almost all of the code in the main App controller.

**Actually, blocks aren't really Contollers..**
No, they're much closer to View Models. However, using that term probably won't get the point across to many Wordpress devs.
