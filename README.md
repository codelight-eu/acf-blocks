# ACF Blocks
ACF Blocks is a lightweight library that provides a clean, object-oriented API to create and render ACF field groups. 

Your WordPress code base doesn't need to be a mess.

## Overview
ACF Blocks introduces the concept of *blocks*, which are essentially Controllers for field groups and flexible layouts. If this sounds scary or confusing, then read on: it's much simpler than it looks.

Fields are created using the excellent [ACF Builder](https://github.com/StoutLogic/acf-builder) library. 

The three main benefits of using ACF blocks are:
- Speed up development of simple sites,
- Provide a clean architecture for developing more complex sites,
- Allow re-using blocks between projects.

## Installation
```
composer require codelight/acf-blocks
```
If you're still not using Composer in 2017, then do yourself a **huge** favor and get started now. [todo: article] 

## Example 1: Quick procedural blocks
As an example, let's go through creating and rendering a simple field group.
```php
<?php
// blocks.php

use Codelight\ACFBlocks\Blocks;
use Codelight\ACFBlocks\BlockType;

add_action('init', function() {

    // Create a new block
    $imageBlock = new BlockType('example_image');
    
    /**
     * Define ACF fields - see https://github.com/StoutLogic/acf-builder
     * Add an image field and a wysiwyg field.
     * Also add the field group to template-image.php page template
     */
    $imageBlock->getFieldsBuilder()
        ->addImage('awesome_image', ['return_format' => 'id'])
        ->addWysiwyg('boring_text')
        ->setLocation('page_template', '==', 'template-image.php');
    
    /**
     * Add a function for processing raw ACF data before it's sent to the template.
     * This allows you to do additional processing depending on the data and keep your templates clean.
     */
    $imageBlock->addCallback(function($data) {
    
        // Return the full image html with srcset attribute generated by wordpress
        $data['image'] = wp_get_attachment_image($data['awesome_image'], 'large');
        
        // Split the wysiwyg contents into an excerpt and the full text
        $data['excerpt'] = wp_trim_words($data['boring_text'], 25);
        $data['text'] = $data['boring_text'];
        
        return $data;
    });
    
    // Set the template for this block
    $imageBlock->setTemplate('templates/blocks/image.php');
    
    // Register the block with the main block manager class
    $blocks = Blocks::getInstance();
    $blocks->registerBlock($imageBlock);
}
```
```php
<?php
/**
 * Template name: Image
 *
 * This is the page template where we will be rendering our block.
 * Calling `blocks()->get()` inside the Loop will return all pre-rendered blocks 
 * assigned to that specific page or post.
 */
?>
<?php while (have_posts()) : the_post(); ?>
    <?php foreach (blocks()->get() as $block): ?>
        <?= $block; ?>
    <?php endforeach; ?>
<?php endwhile; ?>
```
```php
<?php
/**
 * This is the template of the single block.
 * Data is injected automatically.
 */
?>
<section class="section-image">
    <?= $image; ?>
    <div class="description">
        <div class="description-excerpt">
            <?= $excerpt; ?>
        </div>
        <div class="description-full">
            <?= $text; ?>
        </div>
    </div>
</section>
```

## Example 2: Encapsulate the block in a class

## Example 3: Setting up flexible layouts

## FAQ
**Will using this library have an impact on performance?**
No, it's just a really thin layer of abstraction. It doesn't do much, it just allows you to write better code.

**I'm using [soberwp/controller](https://github.com/soberwp/controller) which already provides me with a Controller. Why should I use this library?**
The concept behind soberwp/controller is great, but it has a few major drawbacks. It doesn't have any use in the context of flexible layouts. At the time of writing (Oct 7, 2017), it also has some architectural quirks such as the App controller being constructed twice. Also, inheritance doesn't really work properly so if you want to use the same field groups in multiple layouts, you'll end up stuffing almost all of the code in the main App controller.

**Actually, blocks aren't really Contollers..**
No, they're much closer to View Models. However, using that term probably won't get the point across to many Wordpress devs.
